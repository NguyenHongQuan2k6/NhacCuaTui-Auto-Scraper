name: Auto Scrape NhacCuaTui Daily

# Lên lịch chạy tự động
on:
  schedule:
    # GitHub dùng múi giờ quốc tế (UTC). Việt Nam là UTC+7.
    # Nên 00:00 ở Việt Nam sẽ là 17:00 (chiều hôm trước) theo giờ UTC.
    # Cú pháp cron: Phút Giờ Ngày Tháng Ngày-trong-tuần
    - cron: '0 17 * * *' 
  
  # Cho phép bạn bấm nút chạy thủ công bất cứ lúc nào
  workflow_dispatch: 

jobs:
  build:
    runs-on: ubuntu-latest # Chạy trên máy chủ ảo hệ điều hành Linux miễn phí

    steps:
      - name: Lấy code từ kho về máy chủ ảo
        uses: actions/checkout@v3

      - name: Cài đặt Python 3.10
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Cài đặt các thư viện cần thiết
        run: |
          python -m pip install --upgrade pip
          python -m pip install requests beautifulsoup4

      - name: Chạy file cào dữ liệu
        run: python mainpage.py

      - name: Lưu file CSV mới lên lại GitHub
        run: |
          git config --global user.name "GitHub Actions Bot"
          git config --global user.email "actions@github.com"
          git add data_for_trending_song.csv
          # Nếu có dữ liệu mới thì mới commit, không thì bỏ qua
          git commit -m "Auto-update data at 00:00" || echo "Không có thay đổi dữ liệu"
          git push
